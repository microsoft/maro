

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation Toolkit &#8212; latest</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/fav32x32.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Model" href="data_model.html" />
    <link rel="prev" title="Greedy Policy for Citi Bike" href="../examples/greedy_policy_citi_bike.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">latest</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   What is MARO?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Installation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/pip_install.html">
   Package
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/playground.html">
   Playground Docker Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/grass_cluster_provisioning_on_azure.html">
   Grass Cluster Provisioning on Azure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/k8s_cluster_provisioning_on_azure.html">
   K8S Cluster Provisioning on Azure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/grass_cluster_provisioning_on_premises.html">
   Grass Cluster Provisioning in On-Premises Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/multi_processes_localhost_provisioning.html">
   Multi-processes Localhost Provisioning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Scenarios
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/container_inventory_management.html">
   Container Inventory Management (CIM)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/citi_bike.html">
   Bike Repositioning (Citi Bike)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/vm_scheduling.html">
   Virtual Machine Scheduling (VM Scheduling)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/multi_agent_dqn_cim.html">
   Multi Agent DQN for CIM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/greedy_policy_citi_bike.html">
   Greedy Policy for Citi Bike
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Key Components
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Simulation Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_model.html">
   Data Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="event_buffer.html">
   Event Buffer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="business_engine.html">
   Business Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rl_toolkit.html">
   RL Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distributed_toolkit.html">
   Distributed Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="communication.html">
   Distributed Communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="orchestration.html">
   Distributed Orchestration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dashboard_visualization.html">
   Dashboard Visualization
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  API Documents
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../apidoc/maro.html">
   maro package
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/key_components/simulation_toolkit.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/microsoft/maro"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/microsoft/maro/issues/new?title=Issue%20on%20page%20%2Fkey_components/simulation_toolkit.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/microsoft/maro/edit/master/doc/source/key_components/simulation_toolkit.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environment">
   Environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#critical-components">
   Critical Components
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="simulation-toolkit">
<h1>Simulation Toolkit<a class="headerlink" href="#simulation-toolkit" title="Permalink to this headline">¶</a></h1>
<p>MARO simulation toolkit provides some predefined environments, such as
<a class="reference external" href="../scenarios/container_inventory_management.html">CIM</a>,
<a class="reference external" href="../scenarios/citi_bike.html">Citi Bike</a>, etc.
It also provides some critical and reusable wheels for easily building new scenarios,
with a high-performance guarantee and uniformed programming paradigm, including
<a class="reference external" href="./data_model.html">Data Model</a>, <a class="reference external" href="./event_buffer.html">Event Buffer</a>, and
<a class="reference external" href="./business_engine.html">Business Engine</a>.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The key features of MARO simulation toolkit:</p>
<ul class="simple">
<li><p>Event-driven, which is friendly to business logging data, and more in line
with real-world scenarios;</p></li>
<li><p>High execution performance;</p></li>
<li><p>Low development cost for new environments;</p></li>
<li><p>Convenient interface for spatial-temporal data accessing, which is friendly to
decision-related information querying.</p></li>
</ul>
<p>In order to achieve the key features listed above, we choose Python as the
frontend language. In the meantime, to avoid Python
<a class="reference external" href="https://wiki.python.org/moin/GlobalInterpreterLock">GIL</a> problem and to achieve
the better performance of memory allocation and cache hitting, we choose
<a class="reference external" href="https://cython.org/">Cython</a> as the backend language. Furthermore, we provide a
declarative <a class="reference external" href="./data_model.html">Data Model</a> to auto-generate the related data
class wrapper for easy underlying memory access, a
<a class="reference external" href="./data_model.html#advanced-features">Snapshot List</a> slicing interface to quickly
accessing data from the spatial-temporal and intra-node perspective. Considering
the variously complex scenarios, we decide to build up an event-oriented simulation
system, which is not only suitable to feed existing business logging data but also
convenient to inject random events. New scenarios can be implemented in the
pluggable <a class="reference external" href="./business_engine.html">Business Engine</a> based on the
<a class="reference external" href="./event_buffer.html">Event Buffer</a> supporting. The following figure illustrates
the overall architecture of the MARO simulation system.</p>
<a class="reference external image-reference" href="../images/simulator/overview.svg"><img alt="Simulation System Overall" src="../_images/overview2.svg" width="600" /></a>
</div>
<div class="section" id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<p>Well-designed topologies are provided in each predefined scenario
(i.e. <a class="reference external" href="../scenarios/container_inventory_management.html">CIM</a>,
<a class="reference external" href="../scenarios/citi_bike.html">Citi Bike</a>).
You can specify both the scenario and the topology when initializing an environment.
To distinguish the complicated problems in the real world, we provide various
topologies with different difficulties for the user to do a step-by-step exploration.
In general, the interface of environments is <a class="reference external" href="https://gym.openai.com/">Gym</a>-like,
which use <code class="docutils literal notranslate"><span class="pre">step</span></code> to trigger the environment to apply <code class="docutils literal notranslate"><span class="pre">actions</span></code> from <code class="docutils literal notranslate"><span class="pre">agent(s)</span></code>.
Furthermore, we concern more about the decision mode of multi-agent/hierarchical-agent
and how to conveniently query data on the levels of spatial, temporal, and
intra-node (resource holder). The following shows a typical environment interaction
workflow and code snippet.</p>
<a class="reference external image-reference" href="../images/simulator/interaction_workflow.svg"><img alt="Agent(s)/Environment Interaction Workflow" src="../_images/interaction_workflow.svg" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maro.simulator</span> <span class="kn">import</span> <span class="n">Env</span>
<span class="kn">from</span> <span class="nn">maro.simulator.scenarios.cim.common</span> <span class="kn">import</span> <span class="n">Action</span>

<span class="c1"># Initialize an environment with a specific scenario, related topology.</span>
<span class="c1"># In Container Inventory Management, 1 tick means 1 day, here durations=100 means a length of 100 days</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">(</span><span class="n">scenario</span><span class="o">=</span><span class="s2">&quot;cim&quot;</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="s2">&quot;toy.5p_ssddd_l0.0&quot;</span><span class="p">,</span> <span class="n">start_tick</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">durations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Query environment summary, which includes business instances, intra-instance attributes, etc.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Gym-like step function.</span>
    <span class="n">metrics</span><span class="p">,</span> <span class="n">decision_event</span><span class="p">,</span> <span class="n">is_done</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">is_done</span><span class="p">:</span>
        <span class="n">past_week_ticks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">decision_event</span><span class="o">.</span><span class="n">tick</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="n">decision_event</span><span class="o">.</span><span class="n">tick</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">decision_port_idx</span> <span class="o">=</span> <span class="n">decision_event</span><span class="o">.</span><span class="n">port_idx</span>
        <span class="n">intr_port_infos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;booking&quot;</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span> <span class="s2">&quot;shortage&quot;</span><span class="p">]</span>

        <span class="c1"># Query the snapshot list of the environment to get the information of</span>
        <span class="c1"># the booking, empty container inventory, shortage of the decision port in the past week.</span>
        <span class="n">past_week_info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">[</span><span class="s2">&quot;ports&quot;</span><span class="p">][</span>
            <span class="n">past_week_ticks</span> <span class="p">:</span> <span class="n">decision_port_idx</span> <span class="p">:</span> <span class="n">intr_port_infos</span>
        <span class="p">]</span>

        <span class="n">dummy_action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span>
            <span class="n">vessel_idx</span><span class="o">=</span><span class="n">decision_event</span><span class="o">.</span><span class="n">vessel_idx</span><span class="p">,</span>
            <span class="n">port_idx</span><span class="o">=</span><span class="n">decision_event</span><span class="o">.</span><span class="n">port_idx</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># Drive environment with dummy action (no repositioning).</span>
        <span class="n">metrics</span><span class="p">,</span> <span class="n">decision_event</span><span class="p">,</span> <span class="n">is_done</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dummy_action</span><span class="p">)</span>

    <span class="c1"># Query environment business metrics at the end of an episode,</span>
    <span class="c1"># it is your optimized object (usually includes multi-target).</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ep: </span><span class="si">{</span><span class="n">ep</span><span class="si">}</span><span class="s2">, environment metrics: </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="critical-components">
<h2>Critical Components<a class="headerlink" href="#critical-components" title="Permalink to this headline">¶</a></h2>
<p>These components are the foundation of the whole MARO simulation system and can
be easily reused to build up various real-world business scenarios with good
performance and uniformed pattern. You can find more details in
<a class="reference external" href="./data_model.html">Data Model</a>, <a class="reference external" href="./event_buffer.html">Event Buffer</a>, and
<a class="reference external" href="./business_engine.html">Business Engine</a>.</p>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../examples/greedy_policy_citi_bike.html" title="previous page">Greedy Policy for Citi Bike</a>
    <a class='right-next' id="next-link" href="data_model.html" title="next page">Data Model</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By MARO Team<br/>
        
            &copy; Copyright 2020 Microsoft.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>