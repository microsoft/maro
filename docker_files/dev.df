FROM ubuntu:18.04

WORKDIR /maro

# Install Apt packages
RUN apt-get update --fix-missing
RUN apt-get install -y apt-utils
RUN apt-get install -y sudo
RUN apt-get install -y gcc
RUN apt-get install -y libcurl4 libcurl4-openssl-dev libssl-dev curl
RUN apt-get install -y libzmq3-dev
RUN apt-get install -y python3-pip
RUN apt-get install -y python3-dev libpython3.6-dev python-numpy
RUN rm -rf /var/lib/apt/lists/*

# Install Python packages
RUN pip3 install --upgrade pip
RUN pip install --no-cache-dir Cython==0.29.14
RUN pip install --no-cache-dir pyaml==20.4.0
RUN pip install --no-cache-dir pyzmq==19.0.2
RUN pip install --no-cache-dir numpy==1.19.1
RUN pip install --no-cache-dir torch==1.6.0
RUN pip install --no-cache-dir scipy
RUN pip install --no-cache-dir redis

COPY maro /maro/maro
COPY scripts /maro/scripts/
COPY setup.py /maro/
RUN bash /maro/scripts/install_maro.sh
RUN pip cache purge

RUN rm -r /maro/maro/rl
RUN rm -r /maro/maro/communication

ENV PYTHONPATH=/maro

CMD ["/bin/bash"]
