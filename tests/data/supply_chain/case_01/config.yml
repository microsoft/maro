# Test for ManufactureUnit, StorageUnit, ConsumerUnit

facility_definitions:
  SupplierFacility: &supplier_facility
    class: "SupplierFacility"
    children:
      storage:
        class: "StorageUnit"
      distribution:
        class: "DistributionUnit"
    products:
      class: "ProductUnit"
      config:
        consumer:
          class: "ConsumerUnit"
        manufacture:
          class: "ManufactureUnit"

  SimpleSupplierFacility: &simple_supplier_facility
    class: "SupplierFacility"
    children:
      storage:
        class: "StorageUnit"
      distribution:
        class: "DistributionUnit"
    products:
      class: "ProductUnit"
      config:
        consumer:
          class: "ConsumerUnit"
        manufacture:
          class: "SimpleManufactureUnit"


small_storage: &small_storage
  config:
    capacity: 100
    unit_storage_cost: 1

medium_storage: &medium_storage
  config:
    capacity: 200
    unit_storage_cost: 1


train_config: &train
  config:
    patient: 3

normal_distribution: &normal_distribution
  config:
    train:
      number: 2
      config: *train


skus: &sku_definitions
  - id: 1
    name: "sku1"
    output_units_per_lot: 1
    bom:
      sku3: 2

  - id: 2
    name: "sku2"
    output_units_per_lot: 2
    bom:
      sku1: 4

  - id: 3
    name: "sku3"

  - id: 4
    name: "sku4"
    output_units_per_lot: 2
    bom:
      sku2: 1


world:
  skus: *sku_definitions

  facilities:
    # This supplier will keep generate sku3, and should stop at tick 20 as reach the storage limitation
    - name: "Supplier_SKU3"
      definition_ref: "SupplierFacility"
      skus:
        sku3:
          init_stock: 80
          has_manufacture: True
          max_manufacture_rate: 10
          manufacture_leading_time: 1
          unit_product_cost: 1
          price: 10
      children:
        storage: *small_storage
        distribution: *normal_distribution
      config:
        unit_delay_order_penalty: 10

    - name: "Supplier_SKU1"
      definition_ref: "SupplierFacility"
      skus:
        sku1:
          init_stock: 96
          has_manufacture: True
          max_manufacture_rate: 10
          manufacture_leading_time: 1
          unit_product_cost: 1
          price: 100
        sku3:
          init_stock: 100
          has_consumer: True
          price: 100
      children:
        storage: *medium_storage
        distribution: *normal_distribution
      config:
        unit_delay_order_penalty: 10
        unit_order_cost: 200

    - name: "Supplier_SKU2"
      definition_ref: "SimpleSupplierFacility"
      skus:
        sku1:
          init_stock: 50
          has_consumer: True
          price: 100
        sku2:
          init_stock: 50
          has_manufacture: True
          max_manufacture_rate: 10
          manufacture_leading_time: 1
          unit_product_cost: 1
          price: 100
      children:
        storage: *medium_storage
        distribution: *normal_distribution
      config:
        unit_delay_order_penalty: 10
        unit_order_cost: 200

    - name: "Supplier_SKU4"
      definition_ref: "SupplierFacility"
      skus:
        sku2:
          init_stock: 0
          has_consumer: True
          price: 100
        sku4:
          init_stock: 50
          has_manufacture: True
          max_manufacture_rate: 10
          manufacture_leading_time: 1
          unit_product_cost: 4
          price: 100
        sku3:
          init_stock: 50
          price: 100
      children:
        storage: *medium_storage
        distribution: *normal_distribution
      config:
        unit_delay_order_penalty: 10
        unit_order_cost: 200

  topology:
    Supplier_SKU1:
      sku3:
        "Supplier_SKU3":
          "train":
            vlt: 7
            cost: 1
        "Supplier_SKU4":
          "train":
            vlt: 5
            cost: 1
    Supplier_SKU2:
      sku1:
        "Supplier_SKU1":
          "train":
            vlt: 1  # TODO: test for 0-vlt
            cost: 1
    Supplier_SKU4:
      sku2:
        "Supplier_SKU2":
          "train":
            vlt: 7
            cost: 1

settings:
  pending_order_len: 4
